---
title: "VisualizaciÃ³n de datos con ggplot2"
subtitle: "Explicada con calma ğŸ§˜ğŸ½â€â™€ï¸ğŸ§˜ğŸ½"
lang: "es"
toc: true
comments: false
code-copy: true
format:
  html:
    mermaid:
      theme: forest
bibliography: references.bib
---

```{=html}
<style>
        iframe {
            width: 100%;
            height: 90vh;
            border: none;
        }
    </style>
```
```{r setup, include=FALSE}

library(tidyverse)
library(datos)

```

El paquete `ggplot2` es quizÃ¡ el mÃ¡s querido por la comunidad de usuarios de R. Aunque al inicio puede desesperarnos que nada funcione, esto casi siempre se resuelve cuando tomamos el tiempo de ver un poco de la teorÃ­a que hay detrÃ¡s de ese paquete.

En este taller, nuestro objetivo es aclarar estos conceptos y ayudarte a crear grÃ¡ficos funcionales y, Â¿por quÃ© no?, bonitosğŸ¨.

## GrÃ¡matica de los grÃ¡ficos 

@wilkinson2005grammar creÃ³ la gramÃ¡tica de los grÃ¡ficos para explicar las caracterÃ­sticas bÃ¡sicas de todos los grÃ¡ficos estadÃ­sticos. Esta gramÃ¡tica responde a la pregunta: Â¿quÃ© es un grÃ¡fico estadÃ­stico? ggplot2 @Wickham2009 se basa en esta gramÃ¡tica, destacando la importancia de las capas y adaptÃ¡ndola para usar en R. BÃ¡sicamente, la gramÃ¡tica nos dice que un grÃ¡fico conecta los datos con atributos estÃ©ticos (color, forma, tamaÃ±o) de objetos geomÃ©tricos (puntos, lÃ­neas, barras). El grÃ¡fico tambiÃ©n puede incluir transformaciones estadÃ­sticas de los datos e informaciÃ³n sobre el sistema de coordenadas del grÃ¡fico. AdemÃ¡s, se puede usar el facetado para graficar diferentes subconjuntos de datos. La combinaciÃ³n de todos estos elementos es lo que crea un grÃ¡fico.

```{mermaid}
flowchart TB
    A[Estructura de ggplot2] --> B[Datos]

    A --> C[Mapeo EstÃ©tico]

    A --> D[GeometrÃ­as]

    A --> E[Facetas]

    A --> F[Escalas]

    A --> G[Coordenadas]

    A --> H[Temas]

    A --> I[Etiquetas y Leyendas]
```

![](https://media.wired.com/photos/5954a0cb8e8cc150fa8ec6e7/master/w_2560%2Cc_limit/HighRes_LEGO_DUPLO_bricks-story.jpg)

Imagina la estructura de `ggplot2` como si fueran piezas de Lego que tenemos que ensamblar para construir algo. En este caso, la primera pieza, la base, serÃ­a nuestra capa de datos.

Para este ejemplo, utilizaremos la tabla `pinguinos` del paquete `datos`, una alternativa algo mÃ¡s bonita al clÃ¡sico dataset "iris".

```{r}
pinguinos <- datos::pinguinos
glimpse(pinguinos)
```

![](https://allisonhorst.github.io/palmerpenguins/reference/figures/lter_penguins.png)

Este dataset contiene medidas del alto y largo del pico, peso, sexo y especie de pingÃ¼inos de la AntÃ¡rtida.

![](https://allisonhorst.github.io/palmerpenguins/reference/figures/culmen_depth.png)

## Capa de datos

Esta capa no muestra nada; veremos que aparece un rectÃ¡ngulo gris, pero su funciÃ³n es indicarle a ggplot dÃ³nde debe buscar los datos cuando mencionemos el nombre de alguna variable en el mapeo.

```{r, fig.width=8, fig.height=4.5, dpi=300, fig.retina=3}

ggplot(
  data = pinguinos
)
```

## Mapeo


Esta es quizÃ¡ la parte mÃ¡s importante de nuestro grÃ¡fico. @dataviz-book nos explica que el mapeo es un proceso de traducciÃ³n en el que convertimos variables de nuestra tabla, casi siempre nÃºmeros y categorÃ­as, en atributos como la **posiciÃ³n** (x, y), el **color**, la **forma** o el **tamaÃ±o** de un elemento.

![](https://clauswilke.com/dataviz/aesthetic_mapping_files/figure-html/common-aesthetics-1.png)

Para indicar el mapeo, utilizamos el parÃ¡metro `mapping` y le pasamos una `aes` (abreviatura de "**aesthetic**", que en espaÃ±ol se traduce como "**estÃ©tica**"). Este tÃ©rmino puede ser problemÃ¡tico porque podrÃ­a sugerir que se refiere Ãºnicamente a la apariencia visual del grÃ¡fico. Sin embargo, en este contexto, "estÃ©tica" se refiere a los **atributos fundamentales que conforman un grÃ¡fico**, como la posiciÃ³n (x, y), el color, la forma o el tamaÃ±o de los elementos.

En el Ã¡mbito del arte, la estÃ©tica se ocupa de las propiedades que hacen que una obra de arte **sea significativa y apreciable**, mÃ¡s allÃ¡ de su mera apariencia visual. Del mismo modo, en ggplot2, la estÃ©tica se centra en cÃ³mo se representan los datos de manera que sean comprensibles y efectivos, no solo en cÃ³mo se ven. 


Por ejemplo, en nuestro caso, la variable `largo_pico_mm`, que es una variable numÃ©rica en nuestra tabla, en nuestro grÃ¡fico se va a representar como la posiciÃ³n de los elementos en el **eje x**, y el `alto_pico_mm` pasarÃ¡ a representarse como la posiciÃ³n de los elementos en el **eje y**. Estamos traduciendo nÃºmeros de la tabla a ubicaciones, posiciones, en el espacio del grÃ¡fico. En esto consiste el mapeo.

```{r, fig.width=8, fig.height=4.5, dpi=300, fig.retina=3}
ggplot(
  data = pinguinos,
  mapping = aes(
    x = largo_pico_mm,
    y = alto_pico_mm
  )
)
```

## GeometrÃ­as

Si nuestro grÃ¡fico fuera una construcciÃ³n, digamos una casa, los datos y el mapeo serÃ­an los planos. Pero ahora toca ponerse manos a la obra para construir. Ese es el rol de las geometrÃ­as. Estas **son las encargadas de dibujar los puntos, barras, lÃ­neas o cualquier otro elemento que veamos en el grÃ¡fico**.

![](https://img.freepik.com/fotos-premium/pintores-pintando-exterior-edificio_77206-350.jpg)

Las geometrÃ­as ya saben quÃ© colores, posiciones y tamaÃ±os usar porque se los indicamos en el mapeo, ya vienen en los planos de la casa. Y asÃ­ como hay albaÃ±iles, electricistas y plomeros, cada `geom` se especializa en construir un tipo de grÃ¡fico. Entre los mÃ¡s comunes estÃ¡n:

+ `geom_point`: grÃ¡fico de puntos (dispersiÃ³n)
+ `geom_bar`/`geom_col`: grÃ¡ficos de barras
+ `geom_line`: grÃ¡ficos de lÃ­neas
+ `geom_histogram`: histogramas

En [ggplot2.tidyverse.org](https://ggplot2.tidyverse.org/reference/), puedes encontrar una lista gigante de todas las geometrÃ­as que podemos utilizar, pero por ahora, con estos tenemos mÃ¡s que suficiente.



```{r, fig.width=8, fig.height=4.5, dpi=300, fig.retina=3, warning=FALSE}
ggplot(
  data = pinguinos,
  mapping = aes(
    x = largo_pico_mm,
    y = alto_pico_mm
  )
) +
  geom_point()
```



Si alguna vez has hecho reparaciones en la casa, sabes que siempre al final alguien quiere algÃºn cambio. AsÃ­ que ahora yo quiero que mis puntos tengan colores, pero no cualquiera; quiero que el `color` dependa de la `especie` del pingÃ¼ino. Como lo que queremos es que se tomen datos de la tabla para representarlos en el grÃ¡fico, debemos colocar esto en el `mapping`.

```{r, fig.width=8, fig.height=4.5, dpi=300, fig.retina=3, warning=FALSE}
ggplot(
  data = pinguinos,
  mapping = aes(
    x = largo_pico_mm,
    y = alto_pico_mm,
    color = especie
  )
) +
  geom_point()
```

## Etiquetas

Las formas y los colores no son suficientes para dejar todo claro. Es por eso que todo grÃ¡fico que se precie de profesional debe llevar texto que lo acompaÃ±e: un tÃ­tulo, subtÃ­tulo y una fuente.

Todos estos los vamos a colocar en una capa llamada `labs()`.


```{r, fig.width=8, fig.height=4.5, dpi=300, fig.retina=3, warning=FALSE}
ggplot(
  data = pinguinos,
  mapping = aes(
    x = largo_pico_mm,
    y = alto_pico_mm,
    color = especie
    )
  ) +
  geom_point() +
  labs(
    title = "RelaciÃ³n entre el largo y el alto del pico de los pingÃ¼inos",
    subtitle = "Datos agrupados por especie",
    x = "Largo del pico (mm)",
    y = "Alto del pico (mm)",
    color = "Especie",
    caption = "Fuente: Paquete 'datos'"
  )

```


Aunque podemos encontrar en @INEC2017 una muy buena guÃ­a de cÃ³mo debemos redactar estos tÃ­tulos y subtÃ­tulos para presentar grÃ¡ficos estadÃ­sticos, para los tÃ©rminos del taller vamos a ser mÃ¡s "informales". Sin embargo, vale mucho la pena revisarla.

## Escalas

Al inicio te comentaba que todos aman a ggplot2. Esto se debe a que cosas que antes tenÃ­amos que hacer a mano con el paquete graphics, ahora las podemos hacer de forma casi mÃ¡gicağŸª„. El paquete decide por nosotros aspectos como los colores a usar, las divisiones de los ejes y muchas otras cosas.

A medida que avanzamos, comenzamos a ponernos mÃ¡s exigentes con estos detalles y la primera duda que siempre surge es: "ğŸ’¬ Ok, pero esos colores no me gustan, Â¿puedo poner otros?"

Cuando queremos modificar algo que ggplot2 ha seleccionado por nosotros, utilizamos las escalas.

@ggplot2-book explican de forma mÃ¡s rigurosa que las escalas controlan el mapeo de datos a atributos estÃ©ticos. Transforman tus datos en algo que puedes visualizar, como tamaÃ±o, color, posiciÃ³n o forma. AdemÃ¡s, proporcionan las herramientas que te permiten interpretar el grÃ¡fico, como los ejes y las leyendas. Aunque es posible generar grÃ¡ficos con ggplot2 sin comprender cÃ³mo funcionan las escalas, entenderlas y aprender a manipularlas te darÃ¡ mucho mÃ¡s control sobre tus grÃ¡ficos.

En este caso, para el color vamos a utilizar la escala scale_color_manual. A esta le indicaremos en el parÃ¡metro values los colores que queremos utilizar para nuestro grÃ¡fico.

Para especificar los colores, podemos hacerlo usando el nombre del color. La Universidad de Columbia nos hace el enorme favor de [listar los colores por nombre](http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf), o podemos especificar el cÃ³digo hexadecimal del color. Suena raro, pero es fÃ¡cil. En la computadora, los colores se guardan de manera diferente. Para evitar confusiones, cada posible color que genera la pantalla tiene un cÃ³digo Ãºnico. Estos cÃ³digos se ven algo asÃ­.

![](https://i.pinimg.com/originals/7f/bc/e5/7fbce596b69d62266347e6b753332d15.png){width=30%}
La pregunta obvia es: Â¿y de dÃ³nde saco esos cÃ³digos? Bueno, puedes buscar en Google "color picker" o utilizar sitios web como [Color Hunt](https://colorhunt.co), que tambiÃ©n pueden ser Ãºtiles.

![](color_picker.png){width=80%}


```{r, fig.width=8, fig.height=4.5, dpi=300, fig.retina=3, warning=FALSE}
ggplot(
  data = pinguinos,
  mapping = aes(
    x = largo_pico_mm,
    y = alto_pico_mm,
    color = especie
    )
  ) +
  geom_point() +
  labs(
    title = "RelaciÃ³n entre el largo y el alto del pico de los pingÃ¼inos",
    subtitle = "Datos agrupados por especie",
    x = "Largo del pico (mm)",
    y = "Alto del pico (mm)",
    color = "Especie",
    caption = "Fuente: Paquete 'datos'"
  ) +
  scale_color_manual(
    values = c("#EF9C66","#C738BD","#3AA6B9")
  )

```


## Temas

Los temas son cambios de apariencia que podemos aplicar a los grÃ¡ficos. Aunque mÃ¡s adelante descubrirÃ¡s que podemos hacer cosas muy interesantes con los temas, por ahora solo aplicaremos uno: `theme_minimal()`.


```{r, fig.width=8, fig.height=4.5, dpi=300, fig.retina=3, warning=FALSE}
ggplot(
  data = pinguinos,
  mapping = aes(
    x = largo_pico_mm,
    y = alto_pico_mm,
    color = especie
    )
  ) +
  geom_point() +
  labs(
    title = "RelaciÃ³n entre el largo y el alto del pico de los pingÃ¼inos",
    subtitle = "Datos agrupados por especie",
    x = "Largo del pico (mm)",
    y = "Alto del pico (mm)",
    color = "Especie",
    caption = "Fuente: Paquete 'datos'"
  ) +
  scale_color_manual(
    values = c("#EF9C66","#C738BD","#3AA6B9")
  ) +
  theme_minimal()

```

Como ves, hay bastantes conceptos detrÃ¡s de un grÃ¡fico tan "sencillo" como este. Ahora vamos a practicar directamente en RStudio.